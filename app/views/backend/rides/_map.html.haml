:ruby
  data = []
  resource.crumbs.where(nature: "point").each do |crumb|
    geolocation_point = Charta.new_geometry(crumb.geolocation)
    if geolocation_point
      item = {
        nature: crumb.nature,
        name: crumb.nature,
        shape: geolocation_point,
        read_at: crumb.read_at,
        trajet: resource.number
      }
      data << item
    end
  end

  data_pause = []
  resource.crumbs.where(nature: "pause").each do |crumb|
    geolocation_point = Charta.new_geometry(crumb.geolocation)
    if geolocation_point
      popup_lines = render(partial: 'popup', locals: { crumb: crumb })
      header_content = content_tag(:span, crumb.nature, class: 'sensor-name')
      item = {
        name: crumb.nature,
        shape: geolocation_point,
        popup: { header: header_content, content: popup_lines }
      }
      data_pause << item
    end
  end

  data_first = resource.crumbs.where(nature: "hard_start").first
  data_last = resource.crumbs.where(nature: "hard_stop").first


= visualization do |v|
  - if data.any?
    - v.serie :main, data.sort_by {|h| h[:read_at]}
    - v.paths "trajet", :main
    - if data_first
      - v.serie :data_first, [{name: data_first.nature, shape: data_first.geolocation}]
      - v.points "", :data_first, colors: ['#7fbf7f']
    - if data_last
      - v.serie :data_last, [{name: data_last.nature, shape: data_last.geolocation}]
      - v.points "", :data_last, colors: ['#ff7f7f']
    - if data_pause.any?
      - v.serie :pause, data_pause
      - v.pause_group :nature, :pause
    - v.control :zoom
    - v.control :scale
    - v.control :fullscreen
    - v.control :layer_selector

