:ruby
  all_data = []
  colors = ['#b2b2ff', '#7fbf7f', '#ffff66', '#ff7f7f', '#ff4c4c', '#ffb732', '#b266b2']
  resource.rides.each do |ride|
    ride_data = []
    ride_data_test = []

    ride.crumbs.where.not(nature: "pause").each do |crumb|
      geolocation_point = Charta.new_geometry(crumb.geolocation)
      if geolocation_point
        popup_lines = render(partial: 'popup', locals: { crumb: crumb })
        item = {
          name: crumb.nature,
          shape: geolocation_point,
          read_at: crumb.read_at,
          popup: { header: "Trajet géolocalisé", content: popup_lines },
          Ride: crumb.ride.number
        }

        ride_data_test << item
      end
    end

    ride_data.push(ride_data_test)
    ride_data.push(ride.number)

    all_data <<  ride_data
  end

= visualization do |v| 
  - if all_data.any?
    - all_data.each_with_index do |data, index|
      - v.serie data[1], data[0].sort_by {|h| h[:read_at]}
      - v.paths :ride, data[1], colors: [colors[index%colors.length]]
    - v.control :zoom
    - v.control :scale
    - v.control :fullscreen
    - v.control :layer_selector




